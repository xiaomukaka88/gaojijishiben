# 需求文档

## 引言

高级记事本是一个基于 Tauri 框架的跨平台桌面文本编辑器应用,提供增强的编辑体验和实用功能。该应用支持文本编辑与自动保存、行内计算、科学计算函数、图片粘贴、窗口透明度调节、字体大小调节、置顶显示以及深色/浅色主题切换等核心功能。应用需打包为单个可执行文件,无需额外的依赖或扩展文件。

## 词汇表

- **高级记事本应用**: 基于 Tauri 开发的跨平台桌面文本编辑器
- **自动保存机制**: 应用自动保存用户编辑内容的功能
- **行内计算器**: 在文本编辑器中直接计算数学表达式的功能
- **科学计算函数**: 包括三角函数、对数函数、指数函数等高级数学函数
- **图片粘贴功能**: 将剪贴板中的图片直接粘贴到文本编辑器中的功能
- **窗口透明度**: 主窗口的视觉透明度设置
- **字体大小**: 文本编辑器中显示文本的字体尺寸
- **置顶显示**: 窗口始终显示在其他应用程序窗口之上的功能
- **深色/浅色模式**: 应用的视觉主题模式,分为深色和浅色两种配色方案
- **单可执行文件**: 最终打包为一个独立的 .exe 文件,包含所有依赖

## 需求

### 需求1: 基础文本编辑

**用户故事:** AS 用户,我想要编辑文本内容,以便进行文档记录和信息整理。

#### Acceptance Criteria

1. WHEN 用户在文本编辑区域输入文本,高级记事本应用 SHALL 显示输入的文本内容
2. WHEN 用户选择文本内容,高级记事本应用 SHALL 高亮显示选中的文本
3. WHEN 用户执行复制操作,高级记事本应用 SHALL 将选中文本复制到系统剪贴板
4. WHEN 用户执行粘贴操作,高级记事本应用 SHALL 从系统剪贴板插入文本到光标位置
5. WHEN 用户执行剪切操作,高级记事本应用 SHALL 将选中文本移动到系统剪贴板

### 需求2: 自动保存功能

**用户故事:** AS 用户,我想要系统自动保存我的编辑内容,以便防止意外关闭导致的数据丢失。

#### Acceptance Criteria

1. WHEN 用户在文本编辑区域进行修改,高级记事本应用 SHALL 自动将修改内容保存到本地存储
2. WHILE 用户持续编辑文本,高级记事本应用 SHALL 在每次修改后保存内容
3. WHEN 应用程序意外关闭,高级记事本应用 SHALL 在下次启动时恢复上次保存的内容
4. WHEN 用户手动关闭应用程序,高级记事本应用 SHALL 在关闭前完成最后一次保存操作

### 需求3: 行内计算功能

**用户故事:** AS 用户,我想要在文本中直接计算数学表达式,以便快速获得计算结果。

#### Acceptance Criteria

1. WHEN 用户在文本中输入数学表达式并按下等号键,高级记事本应用 SHALL 计算表达式的值
2. WHILE 用户输入等号后立即按下空格或换行,高级记事本应用 SHALL 将计算结果显示在表达式后方
3. WHEN 数学表达式包含算术运算符(+ - * /),高级记事本应用 SHALL 按照标准运算优先级计算结果
4. WHEN 数学表达式包含括号,高级记事本应用 SHALL 先计算括号内的内容
5. IF 数学表达式语法错误,高级记事本应用 SHALL 在等号后显示错误提示而不修改原文本

### 需求4: 科学计算函数

**用户故事:** AS 用户,我想要使用高级数学函数进行计算,以便解决复杂的数学问题。

#### Acceptance Criteria

1. WHEN 用户使用 sin 函数,高级记事本应用 SHALL 计算输入值的正弦值
2. WHEN 用户使用 cos 函数,高级记事本应用 SHALL 计算输入值的余弦值
3. WHEN 用户使用 tan 函数,高级记事本应用 SHALL 计算输入值的正切值
4. WHEN 用户使用 log 函数,高级记事本应用 SHALL 计算输入值的自然对数值
5. WHEN 用户使用 exp 函数,高级记事本应用 SHALL 计算以 e 为底的指数值
6. WHEN 用户使用 sqrt 函数,高级记事本应用 SHALL 计算输入值的平方根
7. IF 函数的输入参数超出定义域,高级记事本应用 SHALL 显示"无效输入"错误信息

### 需求5: 图片粘贴功能

**用户故事:** AS 用户,我想要直接粘贴图片到记事本中,以便在文档中插入图片内容。

#### Acceptance Criteria

1. WHEN 用户复制图片到系统剪贴板并执行粘贴操作,高级记事本应用 SHALL 将图片插入到文本编辑区域
2. WHILE 图片插入到文档中,高级记事本应用 SHALL 保留图片的原始尺寸和比例
3. WHEN 用户保存文档,高级记事本应用 SHALL 将图片以 Base64 格式嵌入到文档中
4. WHEN 用户打开包含图片的文档,高级记事本应用 SHALL 正确解码并显示嵌入的图片
5. IF 剪贴板内容不是图片格式,高级记事本应用 SHALL 按照文本粘贴规则处理

### 需求6: 窗口透明度调节

**用户故事:** AS 用户,我想要调节窗口的透明度,以便在不同使用场景下获得最佳视觉体验。

#### Acceptance Criteria

1. WHEN 用户打开透明度设置界面,高级记事本应用 SHALL 显示从 20% 到 100% 的透明度滑动条
2. WHILE 用户拖动透明度滑动条,高级记事本应用 SHALL 实时更新窗口透明度
3. WHEN 用户设置透明度为 100%,高级记事本应用 SHALL 显示完全不透明的窗口
4. WHEN 用户设置透明度为 20%,高级记事本应用 SHALL 显示最小透明度但仍保持可读性的窗口
5. WHEN 用户关闭透明度设置界面,高级记事本应用 SHALL 记住上次的透明度设置

### 需求7: 字体大小调节

**用户故事:** AS 用户,我想要调节字体大小,以便根据个人喜好和屏幕分辨率优化阅读体验。

#### Acceptance Criteria

1. WHEN 用户打开字体设置界面,高级记事本应用 SHALL 显示字体大小调节控件
2. WHILE 用户增加字体大小,高级记事本应用 SHALL 实时增大文本编辑区域的字体显示
3. WHILE 用户减少字体大小,高级记事本应用 SHALL 实时减小文本编辑区域的字体显示
4. WHEN 用户设置字体大小到 12px,高级记事本应用 SHALL 显示最小可读字体
5. WHEN 用户设置字体大小到 48px,高级记事本应用 SHALL 显示最大支持字体
6. WHEN 应用程序重新启动,高级记事本应用 SHALL 恢复上次设置的字体大小

### 需求8: 置顶显示功能

**用户故事:** AS 用户,我想要窗口始终显示在最上层,以便在参考其他应用内容时进行编辑。

#### Acceptance Criteria

1. WHEN 用户启用置顶显示选项,高级记事本应用 SHALL 将窗口设置在其他所有应用程序窗口之上
2. WHILE 置顶显示处于启用状态,高级记事本应用 SHALL 保持窗口始终在最上层
3. WHEN 用户禁用置顶显示选项,高级记事本应用 SHALL 取消窗口的最上层显示状态
4. WHEN 应用程序最小化,高级记事本应用 SHALL 暂时忽略置顶显示设置
5. WHEN 应用程序从最小化状态恢复,高级记事本应用 SHALL 恢复之前的置顶显示状态

### 需求9: 深色/浅色模式

**用户故事:** AS 用户,我想要切换深色和浅色主题,以便适应不同的使用环境和个人偏好。

#### Acceptance Criteria

1. WHEN 用户选择浅色模式,高级记事本应用 SHALL 显示浅色背景和深色文本的界面
2. WHEN 用户选择深色模式,高级记事本应用 SHALL 显示深色背景和浅色文本的界面
3. WHILE 应用程序处于运行状态,高级记事本应用 SHALL 保持当前的主题模式
4. WHEN 用户切换主题模式,高级记事本应用 SHALL 实时更新所有界面元素的颜色
5. WHEN 应用程序重新启动,高级记事本应用 SHALL 恢复上次选择的主题模式

### 需求10: 单可执行文件打包

**用户故事:** AS 用户,我想要获得一个独立的可执行文件,以便方便部署和使用应用程序。

#### Acceptance Criteria

1. WHEN 执行应用程序打包命令,高级记事本应用 SHALL 生成单个 .exe 可执行文件
2. WHEN 打包完成,高级记事本应用 SHALL 将所有前端资源和后端依赖嵌入到 .exe 文件中
3. WHEN 用户双击 .exe 文件,高级记事本应用 SHALL 直接启动而无需安装其他依赖
4. WHEN 打包的应用程序运行,高级记事本应用 SHALL 解压嵌入的资源到临时目录
5. WHEN 应用程序关闭,高级记事本应用 SHALL 清理解压的临时资源文件

### 需求11: 表达式解析器

**用户故事:** AS 用户,我想要系统能够正确解析各种数学表达式,以便获得准确的计算结果。

#### Acceptance Criteria

1. WHEN 用户输入包含数字的表达式,表达式解析器 SHALL 正确识别所有数值
2. WHEN 用户输入包含运算符的表达式,表达式解析器 SHALL 按照优先级解析运算顺序
3. WHEN 用户输入包含函数的表达式,表达式解析器 SHALL 正确识别函数名称和参数
4. WHEN 表达式包含嵌套括号,表达式解析器 SHALL 正确处理嵌套层级关系
5. IF 表达式包含语法错误,表达式解析器 SHALL 返回错误信息而不执行计算

### 需求12: 表达式序列化器

**用户故事:** AS 用户,我想要系统能够将计算结果正确地格式化并插入到文本中,以便保持文档的可读性。

#### Acceptance Criteria

1. WHEN 表达式计算结果为整数,表达式序列化器 SHALL 插入不带小数点的结果
2. WHEN 表达式计算结果为浮点数,表达式序列化器 SHALL 插入最多保留 4 位小数的结果
3. WHEN 表达式计算结果为科学计数法表示的大数,表达式序列化器 SHALL 转换为标准小数格式插入
4. WHEN 表达式计算结果为负数,表达式序列化器 SHALL 插入带负号的结果
5. WHEN 表达式计算结果为错误状态,表达式序列化器 SHALL 插入格式化的错误描述信息

### 需求13: 表达式漂亮打印器

**用户故事:** AS 开发人员,我想要查看表达式的结构化表示,以便调试和验证解析逻辑。

#### Acceptance Criteria

1. WHEN 表达式被解析器成功解析,表达式漂亮打印器 SHALL 生成缩进格式化的抽象语法树表示
2. WHEN 表达式包含多个运算符,表达式漂亮打印器 SHALL 按照运算优先级层级进行缩进
3. WHEN 表达式包含函数调用,表达式漂亮打印器 SHALL 在独立行显示函数名称和参数
4. WHEN 表达式包含括号分组,表达式漂亮打印器 SHALL 用缩进表示分组层级
5. IF 表达式包含错误,表达式漂亮打印器 SHALL 在输出中标记错误位置和类型

### 需求14: 表达式往返验证

**用户故事:** AS 开发人员,我想要验证表达式的解析和序列化过程,以确保计算逻辑的正确性。

#### Acceptance Criteria

1. WHEN 表达式被解析器解析,往返验证 SHALL 使用序列化器重新生成文本表示
2. WHEN 重新生成的文本被重新解析,往返验证 SHALL 确认两次解析生成相同的抽象语法树
3. WHEN 表达式包含空白字符,往返验证 SHALL 在重新生成时保留语义无关的空白
4. 当表达式包含括号,往返验证 SHALL 在重新生成时保留括号的原始结构
5. IF 往返验证发现不一致,往返验证 SHALL 记录差异并生成错误报告
