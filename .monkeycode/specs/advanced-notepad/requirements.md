# 需求文档

## 引言

高级记事本是一个功能丰富的文本编辑器，在标准文本编辑功能基础上，集成了行内数学计算、科学计算函数、图片粘贴支持、窗口透明度调节、字体大小调节、窗口置顶、深色/浅色主题切换等功能。该应用使用C#和WinForms/WPF技术开发，可编译为单个独立可执行文件，无需任何外部依赖或扩展文件。

## 词汇表

- **高级记事本**：本文档描述的文本编辑器应用程序
- **主窗口**：应用程序的主要用户界面窗口
- **文本编辑区**：用户输入和编辑文本的主要区域
- **表达式**：待计算的数学表达式字符串（如 "1+2*3"、"sin(30)"）
- **计算结果**：表达式求值后得到的数值结果
- **嵌入图片**：将图片数据以base64编码形式直接嵌入到文本内容中
- **窗口透明度**：主窗口的不透明度级别，范围从0%（完全透明）到100%（完全不透明）
- **置顶模式**：窗口保持在其他所有窗口之上显示的模式
- **深色模式**：使用深色背景和浅色文字的配色方案
- **浅色模式**：使用浅色背景和深色文字的配色方案

## 需求

### 需求 1：基本文本编辑与自动保存

**用户故事：** 作为用户，我想要编辑文本并自动保存，以便不会因为意外关闭程序而丢失编辑内容。

#### 验收标准

1. WHEN 用户启动高级记事本，高级记事本 SHALL 显示一个主窗口，主窗口包含一个文本编辑区
2. WHEN 用户在文本编辑区中输入或修改文本，高级记事本 SHALL 记录文本内容到内存中
3. WHILE 文本编辑区中的文本发生改变后，高级记事本 SHALL 在30秒内将文本内容自动保存到本地文件
4. WHEN 自动保存操作失败，高级记事本 SHALL 显示一个错误提示信息，告知用户保存失败
5. WHEN 用户关闭主窗口，高级记事本 SHALL 保存当前的文本内容到本地文件

### 需求 2：行内数学计算

**用户故事：** 作为用户，我想要在文本中直接输入数学表达式并在末尾加上等号后自动显示计算结果，以便快速进行简单计算。

#### 验收标准

1. WHEN 用户在文本编辑区的某一行输入了包含等号的文本，高级记事本 SHALL 检测该行是否包含数学表达式
2. WHEN 用户在某一行输入了数学表达式并输入等号（如 "1+2*3="），高级记事本 SHALL 计算等号前的表达式值
3. WHEN 表达式计算成功，高级记事本 SHALL 在等号后面插入计算结果（如 "1+2*3=7"）
4. WHEN 表达式包含语法错误（如括号不匹配、非法字符），高级记事本 SHALL 不执行计算操作
5. WHEN 表达式计算结果为浮点数，高级记事本 SHALL 最多显示6位小数

### 需求 3：科学计算函数支持

**用户故事：** 作为用户，我想要使用三角函数、对数、指数等科学计算函数，以便进行复杂的数学计算。

#### 验收标准

1. WHEN 用户在表达式中使用 sin(30) 格式的正弦函数，高级记事本 SHALL 计算以角度为单位的正弦值
2. WHEN 用户在表达式中使用 cos(60) 格式的余弦函数，高级记事本 SHALL 计算以角度为单位的余弦值
3. WHEN 用户在表达式中使用 tan(45) 格式的正切函数，高级记事本 SHALL 计算以角度为单位的正切值
4. WHEN 用户在表达式中使用 log(100) 格式的对数函数，高级记事本 SHALL 计算以10为底的对数值
5. WHEN 用户在表达式中使用 ln(e) 格式的自然对数函数，高级记事本 SHALL 计算以e为底的对数值
6. WHEN 用户在表达式中使用 exp(2) 或 e^2 格式的指数函数，高级记事本 SHALL 计算e的幂次方
7. WHEN 用户在表达式中使用 sqrt(9) 格式的平方根函数，高级记事本 SHALL 计算数值的平方根

### 需求 4：图片粘贴功能（嵌入文本）

**用户故事：** 作为用户，我想要将图片直接粘贴到文本编辑器中并嵌入保存，以便创建图文混排的文档。

#### 验收标准

1. WHEN 用户在文本编辑区执行粘贴操作且剪贴板中包含图片数据，高级记事本 SHALL 将图片编码为base64字符串
2. WHEN 图片编码完成，高级记事本 SHALL 将base64字符串插入到文本编辑区的当前光标位置
3. WHEN 高级记事本 从base64字符串解析嵌入的图片，高级记事本 SHALL 在文本中显示图片的缩略图或占位符
4. WHEN 嵌入的base64图片字符串包含无效数据，高级记事本 SHALL 显示一个损坏图片的图标提示
5. WHEN 文本编辑区同时包含文本和嵌入的图片，高级记事本 SHALL 正确保存和加载混合内容的顺序

### 需求 5：窗口透明度调节

**用户故事：** 作为用户，我想要调节窗口的透明度，以便在需要时能够看到窗口背后的内容。

#### 验收标准

1. WHEN 高级记事本 启动，高级记事本 SHALL 将主窗口的透明度设置为100%（完全不透明）
2. WHEN 用户使用透明度调节滑块或快捷键调整透明度，高级记事本 SHALL 实时更新主窗口的透明度
3. WHEN 透明度被设置为0%，高级记事本 SHALL 显示一个警告提示，告知用户窗口可能难以操作
4. WHEN 用户调节透明度，高级记事本 SHALL 将透明度值保存到配置文件中
5. WHEN 高级记事本 下次启动，高级记事本 SHALL 从配置文件读取上次保存的透明度值并应用到主窗口

### 需求 6：字体大小调节

**用户故事：** 作为用户，我想要调节文本的字体大小，以便根据自己的视力需求舒适地阅读文本。

#### 验收标准

1. WHEN 高级记事本 启动，高级记事本 SHALL 将文本编辑区的字体大小设置为12号字体
2. WHEN 用户使用字体大小调节控件增加字体大小，高级记事本 SHALL 增加文本编辑区中所有文本的字体大小
3. WHEN 用户使用字体大小调节控件减小字体大小，高级记事本 SHALL 减小文本编辑区中所有文本的字体大小
4. WHEN 字体大小被调节，高级记事本 SHALL 将字体大小值保存到配置文件中
5. WHEN 高级记事本 下次启动，高级记事本 SHALL 从配置文件读取上次保存的字体大小值并应用到文本编辑区

### 需求 7：窗口置顶显示

**用户故事：** 作为用户，我想要让窗口始终显示在最上层，以便在操作其他应用程序时能够随时查看或编辑文本内容。

#### 验收标准

1. WHEN 用户点击置顶按钮或使用置顶快捷键，高级记事本 SHALL 将主窗口设置为置顶模式
2. WHILE 主窗口处于置顶模式，高级记事本 SHALL 确保主窗口始终显示在其他所有窗口之上
3. WHEN 用户再次点击置顶按钮或使用置顶快捷键，高级记事本 SHALL 取消主窗口的置顶模式
4. WHEN 主窗口进入或退出置顶模式，高级记事本 SHALL 更新置顶按钮的视觉状态（如高亮显示）
5. WHEN 高级记事本 关闭，高级记事本 SHALL 将置顶模式的状态保存到配置文件中
6. WHEN 高级记事本 下次启动，高级记事本 SHALL 从配置文件读取置顶模式状态并应用到主窗口

### 需求 8：深色/浅色模式切换

**用户故事：** 作为用户，我想要切换深色和浅色配色模式，以便在不同的光线条件下获得舒适的阅读体验。

#### 验收标准

1. WHEN 高级记事本 启动，高级记事本 SHALL 应用浅色配色方案作为默认模式
2. WHEN 用户切换到深色模式，高级记事本 SHALL 将主窗口背景色设置为深灰色（#1E1E1E），文字颜色设置为浅灰色（#DCDCDC）
3. WHEN 用户切换到浅色模式，高级记事本 SHALL 将主窗口背景色设置为白色（#FFFFFF），文字颜色设置为黑色（#000000）
4. WHEN 用户切换配色模式，高级记事本 SHALL 将当前模式保存到配置文件中
5. WHEN 高级记事本 下次启动，高级记事本 SHALL 从配置文件读取上次保存的配色模式并应用
6. WHILE 应用处于深色模式，高级记事本 SHALL 确保所有界面元素（按钮、滚动条、菜单等）都适配深色配色

### 需求 9：单可执行文件部署

**用户故事：** 作为用户，我想要使用一个单独的exe文件运行程序，而不需要安装其他依赖文件，以便方便地携带和部署应用程序。

#### 验收标准

1. WHEN 高级记事本 编译为可执行文件，高级记事本 SHALL 包含所有运行时依赖和资源文件
2. WHEN 用户双击高级记事本.exe文件，高级记事本 SHALL 启动应用程序，无需安装任何其他组件
3. WHEN 高级记事本 运行，高级记事本 SHALL 将所有配置文件和数据文件创建在用户目录下的应用程序文件夹中
4. WHEN 高级记事本.exe文件被复制到其他计算机，高级记事本 SHALL 在目标计算机上正常运行，前提是目标计算机已安装.NET运行时环境
5. WHEN 高级记事本.exe文件在非安装目录运行，高级记事本 SHALL 正确处理相对路径和绝对路径的引用
